<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz: Parametrii functiilor | Clasa 8</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0f0f1a;
            --bg-secondary: #1a1a2e;
            --bg-card: #252540;
            --accent-red: #ef4444;
            --accent-rose: #f43f5e;
            --accent-green: #10b981;
            --accent-cyan: #06b6d4;
            --accent-yellow: #fbbf24;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #3d3d5c;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border-radius: 16px;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .quiz-title {
            font-size: 1.3rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-red), var(--accent-rose));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .xp-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, var(--accent-red), var(--accent-rose));
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 700;
            color: #fff;
        }

        .level-map {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .level-node {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            border: 3px solid var(--border);
            background: var(--bg-card);
        }

        .level-node.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .level-node.locked::after {
            content: 'üîí';
            position: absolute;
            font-size: 1rem;
            bottom: -5px;
            right: -5px;
        }

        .level-node.active {
            border-color: var(--accent-red);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
            animation: pulse 2s infinite;
        }

        .level-node.completed {
            background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
            border-color: var(--accent-green);
        }

        .level-node.completed::after {
            content: '‚úì';
            position: absolute;
            font-size: 0.8rem;
            bottom: -5px;
            right: -5px;
            background: var(--accent-green);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .level-connector {
            width: 30px;
            height: 3px;
            background: var(--border);
            align-self: center;
        }

        .level-connector.completed {
            background: var(--accent-green);
        }

        .quiz-area {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid var(--border);
            min-height: 400px;
        }

        .level-intro {
            text-align: center;
            padding: 2rem;
        }

        .level-intro h2 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--accent-red);
        }

        .level-intro p {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .level-intro .xp-reward {
            display: inline-block;
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-red);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            margin-bottom: 2rem;
        }

        .question-container {
            display: none;
        }

        .question-container.active {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .question-progress {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border);
        }

        .progress-dot.current {
            background: var(--accent-red);
        }

        .progress-dot.correct {
            background: var(--accent-green);
        }

        .progress-dot.wrong {
            background: var(--accent-rose);
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-align: center;
            line-height: 1.6;
        }

        .code-block {
            background: #1e1e3a;
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin: 1rem auto;
            max-width: 550px;
            text-align: left;
            border: 2px solid var(--border);
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 1rem;
            color: #e2e8f0;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        .code-block .keyword {
            color: #c586c0;
        }

        .code-block .type {
            color: #4ec9b0;
        }

        .code-block .number {
            color: #b5cea8;
        }

        .code-block .string {
            color: #ce9178;
        }

        .code-block .comment {
            color: #6a9955;
        }

        .code-block .function {
            color: #dcdcaa;
        }

        .options-grid {
            display: grid;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .option {
            padding: 1.2rem 1.5rem;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
            text-align: left;
        }

        .option:hover {
            border-color: var(--accent-rose);
            transform: translateX(5px);
        }

        .option.selected {
            border-color: var(--accent-cyan);
            background: rgba(6, 182, 212, 0.1);
        }

        .option.correct {
            border-color: var(--accent-green);
            background: rgba(16, 185, 129, 0.2);
        }

        .option.wrong {
            border-color: var(--accent-rose);
            background: rgba(244, 63, 94, 0.2);
        }

        .feedback-box {
            display: none;
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 1.5rem;
            text-align: center;
        }

        .feedback-box.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .feedback-box.correct {
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid var(--accent-green);
        }

        .feedback-box.wrong {
            background: rgba(244, 63, 94, 0.2);
            border: 2px solid var(--accent-rose);
        }

        .feedback-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .feedback-text {
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .explanation {
            font-size: 0.95rem;
            color: var(--text-secondary);
            background: var(--bg-card);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            text-align: left;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-red), var(--accent-rose));
            color: white;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--border);
            color: var(--text-secondary);
        }

        .btn-outline:hover {
            border-color: var(--accent-red);
            color: var(--accent-red);
        }

        .level-complete {
            display: none;
            text-align: center;
            padding: 3rem;
        }

        .level-complete.show {
            display: block;
            animation: celebrate 0.5s ease;
        }

        @keyframes celebrate {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .level-complete-icon {
            font-size: 5rem;
            margin-bottom: 1rem;
        }

        .level-complete h2 {
            font-size: 2rem;
            color: var(--accent-green);
            margin-bottom: 1rem;
        }

        .xp-earned {
            font-size: 2rem;
            color: var(--accent-red);
            margin: 1.5rem 0;
        }

        .score-display {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .stars {
            font-size: 3rem;
            margin: 1rem 0;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .back-link:hover {
            color: var(--accent-cyan);
        }

        @media (max-width: 600px) {
            .container { padding: 1rem; }
            .quiz-header { flex-direction: column; gap: 1rem; }
            .level-node { width: 50px; height: 50px; font-size: 1.2rem; }
            .question-text { font-size: 1.1rem; }
            .code-block { font-size: 0.85rem; padding: 0.8rem; }
        }

        footer {
            margin-top: 3rem;
            padding: 1.5rem;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.85rem;
            border-top: 1px solid var(--border);
        }
    </style>
    <link rel="stylesheet" href="../../../../../assets/css/mobile.css">
    <link rel="stylesheet" href="../../../../../assets/css/mobile-first.css">
    </head>
<body>
    <a href="#main-content" class="skip-link">Sari la continut</a>
    <div id="main-content" class="container">
        <a href="../index.html" class="back-link">‚Üê Inapoi la Modulul 1</a>

        <div class="quiz-header">
            <div class="quiz-title">Quiz: Parametrii functiilor</div>
            <div class="xp-display">
                <span>XP:</span>
                <span id="totalXP">0</span>
            </div>
        </div>

        <div class="level-map">
            <div class="level-node active" data-level="1" onclick="selectLevel(1)">1</div>
            <div class="level-connector"></div>
            <div class="level-node locked" data-level="2" onclick="selectLevel(2)">2</div>
            <div class="level-connector"></div>
            <div class="level-node locked" data-level="3" onclick="selectLevel(3)">3</div>
            <div class="level-connector"></div>
            <div class="level-node locked" data-level="4" onclick="selectLevel(4)">4</div>
            <div class="level-connector"></div>
            <div class="level-node locked" data-level="5" onclick="selectLevel(5)">5</div>
        </div>

        <div class="quiz-area" id="quizArea">
        </div>
    </div>

    <footer>
        <strong>&copy; 2026 Prof. Gurlan Vasile</strong><br>
        Informatica si TIC | <a href="mailto:grlnvasile@gmail.com" style="color: var(--accent-cyan);">grlnvasile@gmail.com</a>
    </footer>

    <script>
        const levels = {
            1: {
                title: "Nivel 1: Ce sunt parametrii?",
                description: "Invata rolul parametrilor in functii",
                xpReward: 50,
                questions: [
                    {
                        text: "Ce sunt parametrii unei functii?",
                        options: [
                            "Erori in program",
                            "Datele pe care functia le primeste pentru a-si face treaba",
                            "Numele functiei",
                            "Tipul returnat"
                        ],
                        correct: 1,
                        explanation: "Parametrii sunt 'ingredientele' pe care functia le primeste. La fel cum o reteta are nevoie de ingrediente (faina, oua, zahar), o functie poate avea nevoie de date (numere, texte) pentru a-si face treaba."
                    },
                    {
                        text: "Cati parametri are aceasta functie?",
                        hasCode: true,
                        codeContent: '<span class="type">int</span> <span class="function">aduna</span>(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c) {\n    <span class="keyword">return</span> a + b + c;\n}',
                        options: [
                            "1 parametru",
                            "2 parametri",
                            "3 parametri",
                            "4 parametri"
                        ],
                        correct: 2,
                        explanation: "Functia are 3 parametri: a, b si c. Fiecare parametru este separat prin virgula in lista de parametri: (int a, int b, int c). Toti sunt de tip int."
                    },
                    {
                        text: "Poate o functie sa nu aiba niciun parametru?",
                        hasCode: true,
                        codeContent: '<span class="type">void</span> <span class="function">afiseazaSalut</span>() {\n    cout << <span class="string">"Salut!"</span> << endl;\n}',
                        options: [
                            "Nu, orice functie trebuie sa aiba cel putin un parametru",
                            "Da, parantezele pot fi goale daca functia nu are nevoie de date externe",
                            "Nu, trebuie sa scriem (void) in paranteze",
                            "Da, dar trebuie sa scriem (null)"
                        ],
                        correct: 1,
                        explanation: "Da! Daca functia nu are nevoie de date din exterior (ca afiseazaSalut), parantezele raman goale (). Functia foloseste doar ce stie deja - in acest caz, textul 'Salut!'."
                    }
                ]
            },
            2: {
                title: "Nivel 2: Parametri formali vs actuali",
                description: "Intelege diferenta dintre cele doua tipuri",
                xpReward: 75,
                questions: [
                    {
                        text: "Ce sunt parametrii formali?",
                        hasCode: true,
                        codeContent: '<span class="comment">// Parametri formali: a si b</span>\n<span class="type">int</span> <span class="function">aduna</span>(<span class="type">int</span> a, <span class="type">int</span> b) {\n    <span class="keyword">return</span> a + b;\n}',
                        options: [
                            "Valorile concrete trimise la apel (5, 3)",
                            "Variabilele din definitia functiei care primesc valorile (a, b)",
                            "Rezultatul functiei",
                            "Numele functiei"
                        ],
                        correct: 1,
                        explanation: "Parametrii FORMALI sunt 'a' si 'b' din definitia functiei - sunt ca niste 'placeholder-e' sau 'cutii goale' care vor primi valorile reale la apelul functiei. Sunt declarati in antetul functiei."
                    },
                    {
                        text: "Ce sunt parametrii actuali (argumentele)?",
                        hasCode: true,
                        codeContent: '<span class="type">int</span> x = <span class="number">5</span>, y = <span class="number">3</span>;\n<span class="type">int</span> rezultat = <span class="function">aduna</span>(x, y);  <span class="comment">// x si y sunt parametri actuali</span>',
                        options: [
                            "Variabilele din definitia functiei",
                            "Valorile concrete trimise functiei la apel",
                            "Tipul returnat",
                            "Corpul functiei"
                        ],
                        correct: 1,
                        explanation: "Parametrii ACTUALI (sau argumentele) sunt valorile REALE trimise functiei la apel. In exemplu, x (care are valoarea 5) si y (care are valoarea 3) sunt trimise functiei aduna()."
                    },
                    {
                        text: "La apelul suma(10, 20), care sunt parametrii actuali?",
                        options: [
                            "suma",
                            "int a, int b",
                            "10 si 20",
                            "return"
                        ],
                        correct: 2,
                        explanation: "10 si 20 sunt parametrii actuali - valorile concrete pe care le trimitem functiei. Acestea vor fi copiate in parametrii formali (a si b) din definitia functiei."
                    }
                ]
            },
            3: {
                title: "Nivel 3: Transmiterea prin valoare",
                description: "Cum sunt copiati parametrii in functie",
                xpReward: 100,
                questions: [
                    {
                        text: "Ce inseamna 'transmitere prin valoare'?",
                        options: [
                            "Parametrul original este modificat de functie",
                            "Functia primeste o COPIE a valorii, originalul ramane neschimbat",
                            "Functia nu primeste nimic",
                            "Valoarea este stearsa"
                        ],
                        correct: 1,
                        explanation: "Transmiterea prin valoare inseamna ca functia primeste o COPIE a datelor. E ca si cum ai fotocopia un document si dai copia - poti scrie pe copie, dar originalul ramane intact!"
                    },
                    {
                        text: "Ce va afisa acest cod?",
                        hasCode: true,
                        codeContent: '<span class="type">void</span> <span class="function">dubleaza</span>(<span class="type">int</span> x) {\n    x = x * <span class="number">2</span>;\n    cout << <span class="string">"In functie: "</span> << x << endl;\n}\n\n<span class="type">int</span> <span class="function">main</span>() {\n    <span class="type">int</span> numar = <span class="number">5</span>;\n    <span class="function">dubleaza</span>(numar);\n    cout << <span class="string">"Dupa apel: "</span> << numar << endl;\n}',
                        options: [
                            "In functie: 10, Dupa apel: 10",
                            "In functie: 10, Dupa apel: 5",
                            "In functie: 5, Dupa apel: 5",
                            "Eroare de compilare"
                        ],
                        correct: 1,
                        explanation: "In functie se dubleaza COPIA (x devine 10), dar variabila 'numar' din main ramane 5! Functia a lucrat pe o copie, nu pe originalul 'numar'. Asta e transmiterea prin valoare."
                    },
                    {
                        text: "De ce este utila transmiterea prin valoare?",
                        options: [
                            "Nu este utila, e doar o problema",
                            "Protejeaza datele originale de modificari accidentale",
                            "Face programul mai lent",
                            "Este obligatorie in C++"
                        ],
                        correct: 1,
                        explanation: "Transmiterea prin valoare PROTEJEAZA datele! Cand apelezi o functie, stii sigur ca variabilele tale nu vor fi modificate accidental. Este un mecanism de siguranta foarte important."
                    }
                ]
            },
            4: {
                title: "Nivel 4: Ordinea si tipurile parametrilor",
                description: "Reguli importante despre parametri",
                xpReward: 125,
                questions: [
                    {
                        text: "Ce se intampla daca apelam functia cu parametri in ordine gresita?",
                        hasCode: true,
                        codeContent: '<span class="type">void</span> <span class="function">afiseazaInfo</span>(<span class="type">string</span> nume, <span class="type">int</span> varsta) {\n    cout << nume << <span class="string">" are "</span> << varsta << <span class="string">" ani"</span>;\n}\n\n<span class="comment">// Apel:</span>\n<span class="function">afiseazaInfo</span>(<span class="number">15</span>, <span class="string">"Ana"</span>);  <span class="comment">// GRESIT!</span>',
                        options: [
                            "Functioneaza corect, ordinea nu conteaza",
                            "Eroare de compilare - tipurile nu se potrivesc",
                            "Programul ruleaza dar da rezultate ciudate",
                            "Compilatorul corecteaza automat"
                        ],
                        correct: 1,
                        explanation: "Eroare! Functia asteapta (string, int) dar primeste (int, string). Ordinea si tipurile CONTEAZA! Parametrii actuali trebuie sa se potriveasca cu parametrii formali in ACEEASI ordine si cu ACELEASI tipuri."
                    },
                    {
                        text: "Ce se intampla daca apelam functia cu mai putini parametri decat are nevoie?",
                        hasCode: true,
                        codeContent: '<span class="type">int</span> <span class="function">aduna</span>(<span class="type">int</span> a, <span class="type">int</span> b) {\n    <span class="keyword">return</span> a + b;\n}\n\n<span class="comment">// Apel:</span>\n<span class="type">int</span> x = <span class="function">aduna</span>(<span class="number">5</span>);  <span class="comment">// Doar 1 parametru!</span>',
                        options: [
                            "Al doilea parametru devine automat 0",
                            "Eroare de compilare - lipseste un argument",
                            "Functia ignora parametrul lipsa",
                            "Programul ruleaza cu avertisment"
                        ],
                        correct: 1,
                        explanation: "Eroare de compilare! Trebuie sa trimiti EXACT cati parametri cere functia (decat daca ai parametri cu valori implicite, dar asta e materie avansata). aduna() cere 2 numere, ai trimis doar 1."
                    },
                    {
                        text: "Care apel este corect pentru functia?",
                        hasCode: true,
                        codeContent: '<span class="type">double</span> <span class="function">calculeazaMedie</span>(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c);',
                        options: [
                            "calculeazaMedie(1, 2);",
                            "calculeazaMedie(1.5, 2.5, 3.5);",
                            "calculeazaMedie(1, 2, 3);",
                            "calculeazaMedie();"
                        ],
                        correct: 2,
                        explanation: "calculeazaMedie(1, 2, 3) este corect! Functia cere 3 int-uri si primeste 3 int-uri. Chiar daca returneza double, parametrii trebuie sa fie int conform definitiei."
                    }
                ]
            },
            5: {
                title: "Nivel 5: Aplicatii practice",
                description: "Testeaza-ti cunostintele cu exemple reale",
                xpReward: 150,
                questions: [
                    {
                        text: "Ce parametri ar trebui sa aiba o functie care calculeaza aria unui dreptunghi?",
                        options: [
                            "Niciun parametru",
                            "Un parametru: latura",
                            "Doi parametri: lungime si latime",
                            "Trei parametri: lungime, latime si arie"
                        ],
                        correct: 2,
                        explanation: "Aria dreptunghiului = lungime * latime, deci functia are nevoie de aceste 2 informatii. Arie este ce CALCULEAZA si RETURNEAZA functia, nu un parametru de intrare!"
                    },
                    {
                        text: "Analizeaza codul. Ce valoare are 'rezultat'?",
                        hasCode: true,
                        codeContent: '<span class="type">int</span> <span class="function">putere</span>(<span class="type">int</span> baza, <span class="type">int</span> exp) {\n    <span class="type">int</span> rez = <span class="number">1</span>;\n    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i < exp; i++)\n        rez *= baza;\n    <span class="keyword">return</span> rez;\n}\n\n<span class="type">int</span> rezultat = <span class="function">putere</span>(<span class="number">2</span>, <span class="number">3</span>);',
                        options: [
                            "5 (2 + 3)",
                            "6 (2 * 3)",
                            "8 (2^3 = 2*2*2)",
                            "9 (3^2)"
                        ],
                        correct: 2,
                        explanation: "putere(2, 3) calculeaza 2^3 = 8. baza=2, exp=3. Bucla se executa de 3 ori: rez=1*2=2, rez=2*2=4, rez=4*2=8. Ordinea conteaza: primul param e baza, al doilea e exponentul!"
                    },
                    {
                        text: "Ce parametri ar avea o functie care verifica daca un elev a promovat?",
                        options: [
                            "bool promovat",
                            "double nota (nota elevului)",
                            "string nume, int varsta",
                            "void"
                        ],
                        correct: 1,
                        explanation: "Functia are nevoie de NOTA elevului pentru a decide daca a promovat. bool ar fi tipul RETURNAT (da/nu), nu parametru. Numele si varsta nu sunt relevante pentru verificare."
                    }
                ]
            }
        };

        let currentLevel = 1;
        let currentQuestion = 0;
        let score = 0;
        let totalXP = 0;
        let levelScores = {};
        let unlockedLevels = [1];

        function loadProgress() {
            const saved = localStorage.getItem('cpp_subprograme_quiz3_progress');
            if (saved) {
                const data = JSON.parse(saved);
                totalXP = data.totalXP || 0;
                unlockedLevels = data.unlockedLevels || [1];
                levelScores = data.levelScores || {};
                updateXPDisplay();
                updateLevelMap();
            }
        }

        function saveProgress() {
            localStorage.setItem('cpp_subprograme_quiz3_progress', JSON.stringify({
                totalXP,
                unlockedLevels,
                levelScores
            }));
        }

        function updateXPDisplay() {
            document.getElementById('totalXP').textContent = totalXP;
        }

        function updateLevelMap() {
            document.querySelectorAll('.level-node').forEach((node, index) => {
                const level = index + 1;
                node.classList.remove('locked', 'active', 'completed');

                if (levelScores[level] !== undefined) {
                    node.classList.add('completed');
                } else if (unlockedLevels.includes(level)) {
                    if (level === Math.max(...unlockedLevels.filter(l => levelScores[l] === undefined))) {
                        node.classList.add('active');
                    }
                } else {
                    node.classList.add('locked');
                }
            });

            document.querySelectorAll('.level-connector').forEach((conn, index) => {
                if (levelScores[index + 1] !== undefined) {
                    conn.classList.add('completed');
                } else {
                    conn.classList.remove('completed');
                }
            });
        }

        function selectLevel(level) {
            if (!unlockedLevels.includes(level)) return;
            currentLevel = level;
            currentQuestion = 0;
            score = 0;
            showLevelIntro();
        }

        function showLevelIntro() {
            const levelData = levels[currentLevel];
            document.getElementById('quizArea').innerHTML = `
                <div class="level-intro">
                    <h2>${levelData.title}</h2>
                    <p>${levelData.description}</p>
                    <div class="xp-reward">+${levelData.xpReward} XP</div>
                    <button class="btn btn-primary" onclick="startLevel()">
                        Incepe Nivelul
                    </button>
                </div>
            `;
        }

        function startLevel() {
            showQuestion();
        }

        function showQuestion() {
            const levelData = levels[currentLevel];
            const q = levelData.questions[currentQuestion];

            let progressDots = '';
            for (let i = 0; i < levelData.questions.length; i++) {
                let dotClass = 'progress-dot';
                if (i === currentQuestion) dotClass += ' current';
                progressDots += `<div class="${dotClass}"></div>`;
            }

            let questionContent = `<p class="question-text">${q.text}</p>`;

            if (q.hasCode) {
                questionContent += `
                    <div class="code-block">
                        ${q.codeContent}
                    </div>
                `;
            }

            let optionsHTML = '';
            q.options.forEach((opt, i) => {
                optionsHTML += `<div class="option" onclick="selectAnswer(${i})">${opt}</div>`;
            });

            document.getElementById('quizArea').innerHTML = `
                <div class="question-container active">
                    <div class="question-progress">${progressDots}</div>
                    ${questionContent}
                    <div class="options-grid">${optionsHTML}</div>
                    <div class="feedback-box" id="feedback"></div>
                    <div style="text-align: center; margin-top: 1.5rem;">
                        <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" style="display: none;">
                            Urmatoarea Intrebare
                        </button>
                    </div>
                </div>
            `;
        }

        function selectAnswer(index) {
            const levelData = levels[currentLevel];
            const q = levelData.questions[currentQuestion];
            const options = document.querySelectorAll('.option');
            const feedback = document.getElementById('feedback');
            const nextBtn = document.getElementById('nextBtn');

            options.forEach(opt => opt.style.pointerEvents = 'none');

            options[index].classList.add(index === q.correct ? 'correct' : 'wrong');
            if (index !== q.correct) {
                options[q.correct].classList.add('correct');
            }

            const dots = document.querySelectorAll('.progress-dot');
            dots[currentQuestion].classList.remove('current');
            dots[currentQuestion].classList.add(index === q.correct ? 'correct' : 'wrong');

            if (index === q.correct) {
                score++;
                feedback.className = 'feedback-box show correct';
                feedback.innerHTML = `
                    <div class="feedback-icon">&#127881;</div>
                    <div class="feedback-text">Corect! Excelent!</div>
                    <div class="explanation">${q.explanation}</div>
                `;
            } else {
                feedback.className = 'feedback-box show wrong';
                feedback.innerHTML = `
                    <div class="feedback-icon">&#128161;</div>
                    <div class="feedback-text">Nu chiar... Hai sa intelegem de ce!</div>
                    <div class="explanation">${q.explanation}</div>
                `;
            }

            nextBtn.style.display = 'inline-flex';
            nextBtn.textContent = currentQuestion < levelData.questions.length - 1 ?
                'Urmatoarea Intrebare' : 'Vezi Rezultatul';
        }

        function nextQuestion() {
            const levelData = levels[currentLevel];
            currentQuestion++;

            if (currentQuestion >= levelData.questions.length) {
                showLevelComplete();
            } else {
                showQuestion();
            }
        }

        function showLevelComplete() {
            const levelData = levels[currentLevel];
            const percentage = Math.round((score / levelData.questions.length) * 100);
            const passed = percentage >= 66;

            let stars = '';
            if (percentage >= 100) stars = '&#11088;&#11088;&#11088;';
            else if (percentage >= 80) stars = '&#11088;&#11088;';
            else if (percentage >= 66) stars = '&#11088;';
            else stars = '&#128170;';

            let earnedXP = 0;
            if (passed) {
                earnedXP = levelData.xpReward;
                if (percentage === 100) earnedXP = Math.round(earnedXP * 1.5);

                if (!levelScores[currentLevel] || levelScores[currentLevel] < percentage) {
                    if (!levelScores[currentLevel]) {
                        totalXP += earnedXP;
                    }
                    levelScores[currentLevel] = percentage;
                }

                if (currentLevel < 5 && !unlockedLevels.includes(currentLevel + 1)) {
                    unlockedLevels.push(currentLevel + 1);
                }

                saveProgress();
                updateXPDisplay();
                updateLevelMap();
            }

            document.getElementById('quizArea').innerHTML = `
                <div class="level-complete show">
                    <div class="level-complete-icon">${passed ? '&#127942;' : '&#128218;'}</div>
                    <h2>${passed ? 'Nivel Completat!' : 'Mai incearca!'}</h2>
                    <div class="stars">${stars}</div>
                    <div class="score-display">${score}/${levelData.questions.length} raspunsuri corecte (${percentage}%)</div>
                    ${passed ? `<div class="xp-earned">+${earnedXP} XP</div>` : ''}
                    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-outline" onclick="selectLevel(${currentLevel})">
                            Reincearca
                        </button>
                        ${passed && currentLevel < 5 ? `
                            <button class="btn btn-primary" onclick="selectLevel(${currentLevel + 1})">
                                Nivelul Urmator
                            </button>
                        ` : ''}
                        ${passed && currentLevel === 5 ? `
                            <button class="btn btn-success" onclick="window.location.href='quiz4-return.html'">
                                Quiz-ul 4: Valoarea de retur
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        loadProgress();
        showLevelIntro();
    </script>
</body>
</html>
